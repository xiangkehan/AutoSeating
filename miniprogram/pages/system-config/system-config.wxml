<!--pages/system-config/system-config.wxml-->
<view class=\"config-container\">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class=\"page-header\">
    <text class=\"page-title\">ç³»ç»Ÿé…ç½®</text>
    <view class=\"header-actions\">
      <button class=\"action-btn\" bind:tap=\"exportConfig\">
        <text class=\"icon\">ğŸ“¤</text>
        å¯¼å‡º
      </button>
      <button class=\"action-btn danger\" bind:tap=\"initConfig\">
        <text class=\"icon\">ğŸ”„</text>
        é‡ç½®
      </button>
    </view>
  </view>

  <!-- åˆ†ç±»é€‰é¡¹å¡ -->
  <view class=\"category-tabs\">
    <view 
      class=\"tab-item {{activeCategory === item.key ? 'active' : ''}}\"
      wx:for=\"{{configCategories}}\"
      wx:key=\"key\"
      data-category=\"{{item.key}}\"
      bind:tap=\"switchCategory\"
    >
      <text class=\"tab-icon\">{{item.icon}}</text>
      <text class=\"tab-name\">{{item.name}}</text>
    </view>
  </view>

  <!-- é…ç½®åˆ—è¡¨ -->
  <view class=\"config-list\" wx:if=\"{{!loading}}\">
    <view 
      class=\"config-item\"
      wx:for=\"{{configs[activeCategory]}}\"
      wx:key=\"config_id\"
    >
      <view class=\"config-header\">
        <view class=\"config-info\">
          <text class=\"config-name\">{{item.name}}</text>
          <text class=\"config-key\">{{item.key}}</text>
        </view>
        <view class=\"config-actions\">
          <button 
            class=\"action-btn small\"
            data-config=\"{{item}}\"
            bind:tap=\"viewHistory\"
          >
            <text class=\"icon\">ğŸ“œ</text>
          </button>
          <button 
            class=\"action-btn small primary\"
            data-config=\"{{item}}\"
            bind:tap=\"editConfig\"
          >
            <text class=\"icon\">âœï¸</text>
          </button>
        </view>
      </view>
      
      <view class=\"config-content\">
        <view class=\"config-description\">
          <text>{{item.description}}</text>
        </view>
        
        <view class=\"config-value\">
          <text class=\"value-label\">å½“å‰å€¼ï¼š</text>
          <text class=\"value-text {{item.value_type}}\">{{formatValue(item.value, item.value_type)}}</text>
        </view>
        
        <view class=\"config-type\">
          <text class=\"type-label\">ç±»å‹ï¼š</text>
          <text class=\"type-text\">{{item.value_type}}</text>
        </view>
        
        <view class=\"config-validation\" wx:if=\"{{item.validation_rules}}\">
          <text class=\"validation-label\">éªŒè¯è§„åˆ™ï¼š</text>
          <text class=\"validation-text\">{{JSON.stringify(item.validation_rules)}}</text>
        </view>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class=\"empty-state\" wx:if=\"{{!configs[activeCategory] || configs[activeCategory].length === 0}}\">
      <text class=\"empty-icon\">âš™ï¸</text>
      <text class=\"empty-text\">è¯¥åˆ†ç±»ä¸‹æš‚æ— é…ç½®é¡¹</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class=\"loading-state\" wx:if=\"{{loading}}\">
    <text class=\"loading-text\">åŠ è½½ä¸­...</text>
  </view>
</view>

<!-- ç¼–è¾‘é…ç½®å¼¹çª— -->
<view class=\"modal-overlay\" wx:if=\"{{showEditModal}}\" catch:tap=\"cancelEdit\">
  <view class=\"modal-content\" catch:tap=\"\">
    <view class=\"modal-header\">
      <text class=\"modal-title\">ç¼–è¾‘é…ç½®</text>
      <button class=\"close-btn\" bind:tap=\"cancelEdit\">Ã—</button>
    </view>
    
    <view class=\"modal-body\" wx:if=\"{{editingConfig}}\">
      <view class=\"edit-info\">
        <text class=\"edit-name\">{{editingConfig.name}}</text>
        <text class=\"edit-description\">{{editingConfig.description}}</text>
      </view>
      
      <view class=\"edit-form\">
        <view class=\"form-item\">
          <text class=\"form-label\">å€¼ç±»å‹ï¼š{{editingConfig.value_type}}</text>
        </view>
        
        <view class=\"form-item\">
          <text class=\"form-label\">æ–°å€¼ï¼š</text>
          <textarea 
            class=\"form-input {{editingConfig.value_type}}\"
            value=\"{{editValue}}\"
            placeholder=\"è¯·è¾“å…¥æ–°çš„é…ç½®å€¼\"
            bind:input=\"onEditValueChange\"
            auto-height=\"{{editingConfig.value_type === 'json' || editingConfig.value_type === 'array'}}\"
          ></textarea>
        </view>
        
        <view class=\"form-item\" wx:if=\"{{editingConfig.validation_rules}}\">
          <text class=\"form-label\">éªŒè¯è§„åˆ™ï¼š</text>
          <text class=\"validation-info\">{{JSON.stringify(editingConfig.validation_rules)}}</text>
        </view>
      </view>
    </view>
    
    <view class=\"modal-footer\">
      <button class=\"modal-btn secondary\" bind:tap=\"cancelEdit\">å–æ¶ˆ</button>
      <button 
        class=\"modal-btn primary {{saveLoading ? 'loading' : ''}}\"
        bind:tap=\"saveConfig\"
        disabled=\"{{saveLoading}}\"
      >
        {{saveLoading ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜'}}
      </button>
    </view>
  </view>
</view>

<!-- å†å²è®°å½•å¼¹çª— -->
<view class=\"modal-overlay\" wx:if=\"{{showHistory}}\" catch:tap=\"closeHistory\">
  <view class=\"modal-content large\" catch:tap=\"\">
    <view class=\"modal-header\">
      <text class=\"modal-title\">é…ç½®å†å²</text>
      <button class=\"close-btn\" bind:tap=\"closeHistory\">Ã—</button>
    </view>
    
    <view class=\"modal-body\">
      <view class=\"history-list\" wx:if=\"{{!historyLoading}}\">
        <view 
          class=\"history-item\"
          wx:for=\"{{configHistory}}\"
          wx:key=\"_id\"
        >
          <view class=\"history-header\">
            <text class=\"history-time\">{{formatDate(item.timestamp)}}</text>
            <text class=\"history-user\">{{item.changed_by_name}}</text>
          </view>
          
          <view class=\"history-content\">
            <view class=\"value-change\">
              <text class=\"change-label\">æ—§å€¼ï¼š</text>
              <text class=\"change-value old\">{{item.old_value}}</text>
            </view>
            <view class=\"value-change\">
              <text class=\"change-label\">æ–°å€¼ï¼š</text>
              <text class=\"change-value new\">{{item.new_value}}</text>
            </view>
          </view>
        </view>
        
        <view class=\"empty-history\" wx:if=\"{{configHistory.length === 0}}\">
          <text class=\"empty-text\">æš‚æ— å†å²è®°å½•</text>
        </view>
      </view>
      
      <view class=\"loading-state\" wx:if=\"{{historyLoading}}\">
        <text class=\"loading-text\">åŠ è½½ä¸­...</text>
      </view>
    </view>
  </view>
</view>

<!-- å¯¼å…¥å¯¼å‡ºå¼¹çª— -->
<view class=\"modal-overlay\" wx:if=\"{{showImportExport}}\" catch:tap=\"closeImportExport\">
  <view class=\"modal-content large\" catch:tap=\"\">
    <view class=\"modal-header\">
      <text class=\"modal-title\">å¯¼å‡ºé…ç½®</text>
      <button class=\"close-btn\" bind:tap=\"closeImportExport\">Ã—</button>
    </view>
    
    <view class=\"modal-body\">
      <view class=\"export-content\">
        <textarea 
          class=\"export-data\"
          value=\"{{exportData}}\"
          readonly
          auto-height
        ></textarea>
      </view>
    </view>
    
    <view class=\"modal-footer\">
      <button class=\"modal-btn secondary\" bind:tap=\"closeImportExport\">å…³é—­</button>
      <button class=\"modal-btn primary\" bind:tap=\"copyExportData\">å¤åˆ¶</button>
    </view>
  </view>
</view>", "file_path": "c:\\Users\\xjh20\\WeChatProjects\\miniprogram-2\\miniprogram\\pages\\system-config\\system-config.wxml"}]